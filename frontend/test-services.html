<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Dịch vụ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        margin-bottom: 20px;
        color: #333;
      }

      .controls {
        margin-bottom: 20px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .api-info {
        margin-bottom: 15px;
        padding: 10px;
        background: #e3f2fd;
        border-radius: 5px;
      }

      .api-info code {
        font-family: monospace;
        background: #f1f1f1;
        padding: 2px 5px;
        border-radius: 3px;
      }

      .buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      button {
        padding: 10px 20px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      button:hover {
        background: #2980b9;
      }

      .btn-success {
        background: #2ecc71;
      }

      .btn-success:hover {
        background: #27ae60;
      }

      .btn-danger {
        background: #e74c3c;
      }

      .btn-danger:hover {
        background: #c0392b;
      }

      .results {
        margin-top: 20px;
      }

      .service-card {
        background: white;
        padding: 20px;
        margin-bottom: 15px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .service-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
      }

      .service-name {
        font-size: 20px;
        font-weight: bold;
        color: #2c3e50;
      }

      .service-price {
        font-size: 18px;
        color: #e74c3c;
        font-weight: bold;
      }

      .service-category {
        display: inline-block;
        padding: 3px 10px;
        background: #3498db;
        color: white;
        border-radius: 15px;
        font-size: 12px;
        margin-bottom: 10px;
      }

      .service-description {
        color: #666;
        margin-bottom: 10px;
        line-height: 1.5;
      }

      .service-status {
        display: inline-block;
        padding: 3px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
      }

      .status-available {
        background: #d4edda;
        color: #155724;
      }

      .status-unavailable {
        background: #f8d7da;
        color: #721c24;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: #666;
      }

      .loading i {
        display: block;
        font-size: 40px;
        margin-bottom: 10px;
        color: #3498db;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      pre {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 5px;
        overflow-x: auto;
        margin-top: 20px;
        font-size: 12px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <h1>Test API Dịch vụ</h1>

      <div class="controls">
        <div class="api-info">
          <strong>API Endpoint:</strong>
          <code
            >http://localhost/Web-DatPhong-main/backend/api/controllers/ServiceController.php</code
          >
        </div>

        <div class="buttons">
          <button onclick="loadAllServices()" class="btn-success">
            <i class="fas fa-sync"></i> Load All Services
          </button>
          <button onclick="testConnection()">
            <i class="fas fa-plug"></i> Test Connection
          </button>
          <button onclick="clearResults()" class="btn-danger">
            <i class="fas fa-trash"></i> Clear Results
          </button>
        </div>
      </div>

      <div class="results" id="results-container">
        <div class="loading" id="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Click "Load All Services" để bắt đầu</p>
        </div>
      </div>

      <pre id="raw-data"></pre>
    </div>

    <script>
      const API_BASE_URL =
        "http://localhost/Web-DatPhong-main/backend/api/controllers";
      const resultsContainer = document.getElementById("results-container");
      const loadingElement = document.getElementById("loading");
      const rawDataElement = document.getElementById("raw-data");

      function showLoading(show) {
        loadingElement.style.display = show ? "block" : "none";
      }

      function showError(message) {
        resultsContainer.innerHTML = `
                <div class="error">
                    <h3><i class="fas fa-exclamation-triangle"></i> Lỗi</h3>
                    <p>${message}</p>
                    <button onclick="loadAllServices()" style="margin-top: 10px; padding: 5px 15px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer;">
                        Thử lại
                    </button>
                </div>
            `;
      }

      async function testConnection() {
        showLoading(true);
        try {
          const response = await fetch(
            `${API_BASE_URL}/ServiceController.php?action=getAll&limit=1`,
            {
              method: "GET",
              headers: {
                Accept: "application/json",
              },
            }
          );

          if (response.ok) {
            alert("✅ Kết nối API thành công!");
          } else {
            alert(`❌ Lỗi kết nối: ${response.status} ${response.statusText}`);
          }
        } catch (error) {
          alert(`❌ Lỗi kết nối: ${error.message}`);
        } finally {
          showLoading(false);
        }
      }

      async function loadAllServices() {
        showLoading(true);
        try {
          const url = `${API_BASE_URL}/ServiceController.php?action=getAll`;
          console.log("Fetching:", url);

          const response = await fetch(url, {
            method: "GET",
            headers: {
              Accept: "application/json",
            },
          });

          console.log("Response status:", response.status);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          console.log("API response:", data);

          // Show raw JSON data
          rawDataElement.textContent = JSON.stringify(data, null, 2);

          if (data.success && data.data && data.data.length > 0) {
            renderServices(data.data);
          } else {
            resultsContainer.innerHTML = `
                        <div class="error">
                            <p>${data.message || "Không có dịch vụ nào"}</p>
                            <p>Raw response: ${JSON.stringify(data)}</p>
                        </div>
                    `;
          }
        } catch (error) {
          console.error("Error:", error);
          showError(
            `Lỗi: ${error.message}<br><br>URL: ${API_BASE_URL}/ServiceController.php?action=getAll`
          );
        } finally {
          showLoading(false);
        }
      }

      function renderServices(services) {
        if (services.length === 0) {
          resultsContainer.innerHTML = "<p>Không có dịch vụ nào</p>";
          return;
        }

        const html = services
          .map((service) => {
            const price = parseFloat(service.price) || 0;
            const isAvailable =
              service.status === "available" || service.status === "active";
            const statusClass = isAvailable
              ? "status-available"
              : "status-unavailable";
            const statusText = isAvailable ? "Có sẵn" : "Tạm ngừng";
            const category = service.category || "other";

            // Category mapping
            const categoryMap = {
              transport: "Vận chuyển",
              food: "Ẩm thực",
              spa: "Spa & Massage",
              other: "Khác",
            };

            const categoryName = categoryMap[category] || category;

            return `
                    <div class="service-card">
                        <div class="service-header">
                            <div class="service-name">${
                              service.service_name ||
                              service.name ||
                              "Dịch vụ không tên"
                            }</div>
                            <div class="service-price">${price.toLocaleString(
                              "vi-VN"
                            )} VND</div>
                        </div>
                        <div class="service-category">${categoryName}</div>
                        <div class="service-status ${statusClass}">${statusText}</div>
                        <div class="service-description">${
                          service.description || "Không có mô tả"
                        }</div>
                        <div style="font-size: 12px; color: #999;">ID: ${
                          service.id
                        } | Category: ${category}</div>
                    </div>
                `;
          })
          .join("");

        resultsContainer.innerHTML = `
                <h3>Found ${services.length} services:</h3>
                ${html}
            `;
      }

      function clearResults() {
        resultsContainer.innerHTML = `
                <div class="loading" id="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Click "Load All Services" để bắt đầu</p>
                </div>
            `;
        rawDataElement.textContent = "";
      }

      // Test connection on page load
      document.addEventListener("DOMContentLoaded", testConnection);
    </script>
  </body>
</html>
